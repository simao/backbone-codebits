<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Give a backbone to your web apps</title>
	
	<meta name="description" content="Give a backbone to your web apps">
	<meta name="author" content="Simão Mata">
	<meta name="viewport" content="width=1024, user-scalable=no">
	
	<!-- Core and extension CSS files -->
	<link rel="stylesheet" href="vendors/deck.js/core/deck.core.css">
	<link rel="stylesheet" href="vendors/deck.js/extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="vendors/deck.js/extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="vendors/deck.js/extensions/status/deck.status.css">
	<link rel="stylesheet"
              href="vendors/deck.js/extensions/hash/deck.hash.css">

	<link rel="stylesheet" href="introduction.css">
	
	<!-- Theme CSS files (menu swaps these out) -->
	<link rel="stylesheet" id="style-theme-link" href="themes/style/swiss.css">
<!--	<link rel="stylesheet" id="transition-theme-link"  href="themes/transition/horizontal-slide.css"> -->
	
	<!-- Custom CSS just for this page -->
	<link rel="stylesheet" href="introduction.css">
	
	<script src="vendors/modernizr.custom.js"></script>
        
        
        <link rel="stylesheet" href="vendors/deck.js/extensions/codemirror/deck.codemirror.css">
        <link rel="stylesheet" href="vendors/deck.js/extensions/codemirror/themes/default.css">
</head>

<body class="deck-container">


<section class="slide" id="title-slide">
	<h1>Give a backbone to your web apps
          <br>
          <span style="color: gray; font-size: 0.5em">Simão Mata - @simaom<br>
          http://spreadd.com</span>
        </h1>


</section>

<section class="slide" id="why">
  <h1>Why do you need Backbone</h1>
</section>

<section class="slide" id="why-2">
  <h1>You Don't</h1>
</section>

<section class="slide" id="why-3">
<h1><span class="pink">You need Structure</span></h1>
</section>


<!--

Falar no HTML ficar de facto misturado com javascript


Manipulação do DOM misturada com código de validações e código ajax, etc etc 

No separation of concernss

Dificil de testar/manter quando isto esta tudo misturado

-->

<section class="slide" id="structure">
  <h2>Structure, you say?</h2>

  <h3>Every application needs structure, a web app is not an exception</h3>

  <h4>Typical problems:</h4>
  
  <ul>
    <li>Spaghetti code</li>
    <li>Presentation code coupled with data</li>
    <li>Presentation code mixed with business logic </li>
    <li>Event handling code scattered all over the application</li>
  </ul>
</section>


<section class="slide" id="solution">
  <h1>So, how do we solve this?</h1>
</section>

<section class="slide" id="solution-2">
  <h1><span class="pink">So, how do we solve this?</span><br>

The same way we solve it in other applications</h1>
</section>

<section class="slide" id="mvc-2">
  <h1 style="text-align:left; margin-left: 2.5em">
    <span class="pink">M</span>odel,<br>
    <span class="pink">V</span>iew,<br>
    <span class="pink">C</span>ontroller
</h1>
</section>


<section class="slide" id="mvc-3">
  <h2>Typical MVC implementation for a Web Application</h2>
  <img src="img/http_mvc.png" alt="Web App MVC">
</section>

<section class="slide" id="mvc-4">
  <h2>Server-side MVC</h2>

  <p>MVC gives structure to your server side application.</p>

  <ul>
    <li><strong>Separation of concerns</strong> Business logic is
    isolated from the user interface code and the persistence layer
    mechanism </li>

    <li><strong>Minimizes Coupling</strong> Every component can work
    independently from each other </li>
  </ul>
</section>


<section class="slide" id="mvc-5">
  <h1>What about all that client code?</h1>
</section>


<!-- Backbone supplies structure to JavaScript-heavy applications by
providing models with key-value binding and custom events, collections
with a rich API of enumerable functions, views with declarative event
handling, and connects it all to your existing application over a
RESTful JSON interface.

Different implementations of the Model-View-Controller pattern tend to
disagree about the definition of a controller. If it helps any, in
Backbone, the View class can also be thought of as a kind of
controller, dispatching events that originate from the UI, with the
HTML template serving as the true view. We call it a View because it
represents a logical chunk of UI, responsible for the contents of a
single DOM element.

Backbone.Model – Like a Rails model minus the class methods. Wraps a row of data in business logic.
Backbone.Collection – A group of models on the client-side, with sorting/filtering/aggregation logic.
Backbone.Router – Rails routes.rb + Rails controller actions. Maps URLs to functions.
Backbone.View – A logical, re-usable piece of UI. Often, but not always, associated with a model.
Client-side Templates – Rails .html.erb views, rendering a chunk of HTML.
-->

<section class="slide" id="what-is-backbone">
  <h2>Enter Backbone JS</h2>

  <h3>Not your Rails/Django/... MVC</h3>

  <p>Backbone supplies <strong>structure</strong> to web applications by providing
    <strong>Models, Collections, Views and Events</strong></p>

  <ul>
    <li><strong>Backbone.Model</strong> Like a Rails/Django model, wraps data with business logic</li>
    <li><strong>Backbone.View</strong> A re-usable piece of UI, often associated with a model. Dispatches events that originate from the UI</li>
    <li><strong>Backbone.Collection</strong> A group of models on the client-side</li>
    <li><strong>Templates</strong> Like Rails .html.erb views or Django templates
  </ul>
  
  <p>All connected with key-value binding, custom events and
  declarative event handling</p>

  <h3>Where's the controller?</h3>
  <p>Backbone uses <strong>Backbone.Router</strong> to map urls and hashes to functions</p>
</section>


<section class="slide" id="models">
  <h2>Backbone.Model</h2>

  <p>Models contain the web app data and a big part of it's logic:
conversions, validations, computed properties, etc</p>

  <ul>
    <li>Powerful wrapper around a JSON object</li>
    <li>Like a traditional Model, but with a simpler API</li>
    <li>Event binding support for many different event types,
    (e.g. change of an attribute, refresh, etc...)</li>
    <li>Able to sync with a server site RESTful JSON API</li>
    <ul>
      <li>But you don't need a RESTful API</li>
      <!-- <li>You can save your models using localStorage or in
      memory</li> -->
    </ul>
    <li>Extend Backbone.Model with your domain-specific methods</li>
  </ul>
</section>

<!-- TODO: Code for Models -->

<section class="slide" id="models-code">

  <h2>Backbone.Model Code</h2>


  <div>
  <textarea id="code-models" name="code-models" class="code" mode="javascript" style="display: none;" 
       globals="$,Backbone,_" runnable="true">
    var Book = Backbone.Model.extend({
	    makeName : function () {
    		return 'Author: ' + this.get('author') +
    			', Title: ' + this.get('title');
	    }
    });

    var myBook = new Book({title: "JavaScript: The good parts"});
    myBook.set({author: "Douglas Crockford"});

    console.log(myBook.makeName());
  </textarea>
  </div>

</section>



<!-- Collections are ordered sets of models. You can to bind "change"
events to be notified when any model in the collection has been
modified, listen for "add" and "remove" events, fetch the collection
from the server, and use a full suite of Underscore.js methods.

Any event that is triggered on a model in a collection will also be
triggered on the collection directly, for convenience. This allows you
to listen for changes to specific attributes in any model in a
collection, for example: Documents.bind("change:selected", ...)
-->

<section class="slide" id="collections">
  <h2>Backbone.Collection</h2>

  <p>An object containing many instances of a model class</p>

  <ul>
    <li>Can update itself using via AJAX using a simple method call</li>
    <li>Allows event binding to change events on any model in the collection</li>
    <li>Supports most Underscore JS array functions, inspired by Ruby's Enumerable methods</li>
  </ul>

</section>


<script type="codemirror" data-selector="#code-collections">
    var Book = Backbone.Model.extend({});
</script>

<section class="slide" id="collections-code">
  
  <h2>Backbone.Collection Code</h2>

  <div id="code-collections" name="code-collections" class="code" mode="javascript" style="display: none;" 
       globals="$,Backbone,_" runnable="true">

    var Library = Backbone.Collection.extend({
    	model: Book
    });

    var myLibrary = new Library;

    myLibrary.add(new Book({title: "The Time Machine"}));

    var myBook = myLibrary.first();

    console.log(myBook.get('title'));
    console.log("Library size: " + myLibrary.length)
  </div>

</section>

<script type="codemirror" data-selector="#code-collections-events">
    var Book = Backbone.Model.extend({});
    var Library = Backbone.Collection.extend({
    	model: Book
    });
</script>

<section class="slide" id="collections-events">
  
  <h2>Backbone.Collection Events</h2>


  <div>
  <div id="code-collections-events" name="code-collections-events" class="code" mode="javascript" style="display: none;" 
       globals="$,Backbone,_" runnable="true">
    var myLibrary = new Library;

    myLibrary.bind("add", function (model) {
    	console.log("New book added to collection: " + model.get('title'));
    });

    myLibrary.add(new Book({title: "The Time Machine"}));
  </div>
  </div>
</section>



<!--
    Coisas para falar:

Views — they don't determine anything about your HTML or CSS for you,
and can be used with any JavaScript templating library. The general
idea is to organize your interface into logical views, backed by
models, each of which can be updated independently when the model
changes, without having to redraw the page. Instead of digging into a
JSON object, looking up an element in the DOM, and updating the HTML
by hand, you can bind your view's render function to the model's
"change" event — and now everywhere that model data is displayed in
the UI, it is always immediately up to date.
-->


<section class="slide" id="views">
  <h2>Backbone.Views</h2>

  <ul>
    <li>They don't determine anything about your HTML, that's the template's job</li>
    <li>They glue the model with the template</li>
    <li>The idea is to organize the interface into logical views,
    backed by models, each of which can be updated independently when
    the model changes</li>
    <li>You can bind a your view's render function to a
    model <strong>change</strong> event</li>
    <li>Can use any templating library</li>
  </ul>
</section>


<section class="slide" id="views-code">
    <h2>Backbone.View Code</h2>

  <div id="code-views" name="code-views" class="code" mode="javascript" style="display: none;" 
       >var BookView = Backbone.View.extend({

    events: {
    	"dblclick"		    : "open",
    	"click .icon.book"	    : "select",
    	.......
    },
         
    render: function() {
    	$(this.el).html(this.template(this.model.toJSON()));
    	   return this;
    },
         
    open: function() {
    	window.open(this.model.get("book_detail_url"));
    },
    
    select: function() {
    	this.model.set({selected: true});
    },
    ...
});
  </div>

</section>



<!-- 
Events is a module that can be mixed in to any object, giving the
object the ability to bind and trigger custom named events. Events do
not have to be declared before they are bound, and may take passed
arguments. For example:
-->

<section class="slide" id="events">
  <h2>Backbone.Events</h2>

  <p>Can be mixed in to any object</p>

  <ul> 
    <li>Simple, yet powerful API to handle events</li>
    <li>Gives object the ability to bind and trigger custom named events.</li>   
  </ul>

  <div id="code-events" name="code-events" class="code" mode="javascript" style="display: none;" 
   globals="$,Backbone,_" runnable="true">var object = {};

_.extend(object, Backbone.Events);

object.bind("custom-event", function(msg) {
	console.log("Triggered " + msg);
});

object.trigger("custom-event", "An event")
  </div>

</section>


<section class="slide" id="code-1">
  <h1>&lt;code&gt;</h1>
</section>


<section class="slide" id="tweet-model">
  <h2>A Model</h2>
<div>
  <textarea name="tweet-model-code" id="tweet-model-code" class="code" mode="javascript"
            style="display:none;" globals="$,_,Backbone"
            runnable="true">

    var Tweet = Backbone.Model.extend({    });

    var t = new Tweet({id: "131503891199172610", "text": "Hello Codebits"});

    console.log(t.get('text'))
  </textarea>
</div> 
</section>


<script type="codemirror" data-selector="#tweet-view-code,
                                         #tweet-collection-code, #tweets-view-code">
    var Tweet = Backbone.Model.extend({});
</script>


<section class="slide" id="tweet-view">
  <h2>A View</h2>
<div>
  <textarea name="tweet-view-code" id="tweet-view-code" class="code" mode="javascript"
            style="display:none;" globals="$,_,Backbone"
            runnable="true">

    var TweetView = Backbone.View.extend({
    	initialize : function (options) {
    		this.template = options.template;
    	},
    
    	render : function () {
    		var $el = $(this.el).hide();
    		$el.html(_.template(this.template, this.model.toJSON()))
		.fadeIn();
    		return this;
    	}
    });

    var template = "<strong><%=author%></strong> tweeted: "+ 
    			"<span style='color:blue'><%=text%></span><br>";

    var t = new Tweet({author: "batráquio", text: "1 2 3 Testing"});
    var v = new TweetView({
    			el: $("#tweet-container"), model: t, 
    			template: template});

    v.render();

  </textarea>
</div> 

<div id="tweet-container"></div>

</section>


<section class="slide" id="tweet-collection">
  <h2>A Collection of Tweets</h2>
<div>
  <textarea name="tweet-collection-code" id="tweet-collection-code" class="code" mode="javascript"
            style="display:none;" globals="$,_,Backbone"
            runnable="true">

    var Tweets = Backbone.Collection.extend({
    	model: Tweet,

    	initialize : function (models, options) {
    		this.tag = options.tag || "codebits";
    	},

    	url : function () {
    		return '/tweets/' + this.tag;
    	},

	comparator: function (model) {
    		return -1 * model.get('date');
    	},
    });

    var codebits_tweets = new Tweets({}, {tag: "scala"});

    codebits_tweets.fetch({success: function () {
	console.log("Success. Obtained " + codebits_tweets.length + 
    		" tweets from the server")
    }})
  </textarea>
</div> 
</section>

<script type="codemirror" data-selector="#tweets-view-code">
    var TweetView = Backbone.View.extend({
    	initialize : function (options) {
    		this.template = "<strong><%=author%></strong> tweeted: "+ 
    			"<span style='color:navy'><%=text%></span><br><br>";
    	},
    
    	render : function () {
    		var $el = $(this.el).hide();
    		$el.html(_.template(this.template, this.model.toJSON()))
		.fadeIn();
    		return this;
    	}
    });

    var Tweets = Backbone.Collection.extend({
    	model: Tweet,

    	initialize : function (models, options) {
    		this.tag = options.tag || "codebits";
    	},

	comparator: function (model) {
    		return -1 * model.get('date');
    	},

    	url : function () {
    		return './tweets/' + this.tag;
    }
    });
</script>


<section class="slide" id="tweets-view">
  <h2>A Real Timeline</h2>
<div id="tweets-view-code-div">
  <textarea name="tweets-view-code" id="tweets-view-code" class="code" mode="javascript"
            style="display:none;" globals="$,_,Backbone"
            runnable="true">

var Timeline = Backbone.View.extend({
	model: new Tweets({}, {tag: "codebits"}),
	
	initialize: function () {
		_.bindAll(this);

		this.model.bind("add", this.addOne);
		this.model.bind("reset", this.addAll);

		this.model.fetch(); // Update the timeline, right now
	},

	addOne: function (model) {
		var view = new TweetView({model: model});
		$(this.el).append(view.render().el);
	},
	
	addAll: function (models) {
		this.model.each(this.addOne);
	}
});
	var container = $("#dtimeline").html("");
	var my_timeline = new Timeline({el: container});
  </textarea>
</div> 

<a href="#tweets-view" style="color: gray; font-size: 10pt" onclick="javascript:$('#tweets-view-code-div').slideToggle()">o</a>

  <div id="dtimeline"></div>
</section>

<section class="slide" id="code-end">
    <h1>&lt;/code&gt;</h1>
</section>



<section class="slide" id="">
  <h2>Power Tips</h2>

  <ul>
    <li>Watch out when following the "official" TODO example</li>
    <li>Always remember binding <code>this</code></li>
    <li>Learn to love underscore.js - "It's the tie to go along with jQuery's tux."</li>
  </ul>

  <!-- Funny tips image -->
</section>


<!--

Não é uma caixa negra que nao percebemos, sabemos o que se passa e nao
há magia

Gosto de soluções simples

-->


<section class="slide" id="why-backbone">
<h2>Why backbone and not X</h2>

<h3>Backbone is great</h3>
<ul>
  <li>Good documentation</li>
  <li>Very readable code and small code base</li>
  <li>Very lightweight, <strong>4.6 kb</strong>, gzipped</li>
  <li>Mobile ready</li>
</ul>

<h3>Alternatives</h3>
  <ul>
    <li>Knockout.js</li>
    <li>Sproutcore</li>
    <li>JavaScript MVC</li>
    <li>...</li>
    <li>Probably awesome too</li>
  </ul>
</section>

<section class="slide" id="thanks-to">
  <h2>References</h2>
  <ul>
    <li>Backbone.JS - <a href="http://documentcloud.github.com/backbone/">github</a></li>
    <li>Pivotal Labs talk on Backbone.js</li>
  </ul>
</section>


<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<script src="vendors/jquery-1.6.4.min.js"></script>

<script src="vendors/underscore.js"></script>
<script src="vendors/backbone.js"></script>

<!-- Deck Core and extensions -->
<script src="vendors/deck.js/core/deck.core.js"></script>
<script src="vendors/deck.js/extensions/menu/deck.menu.js"></script>
<script src="vendors/deck.js/extensions/goto/deck.goto.js"></script>
<script src="vendors/deck.js/extensions/status/deck.status.js"></script>
<script src="vendors/deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="vendors/deck.js/extensions/hash/deck.hash.js"></script>

<!-- Codemiror code -->
<script src="vendors/deck.js/extensions/codemirror/codemirror.js"></script>
<script src="vendors/deck.js/extensions/codemirror/mode/javascript/javascript.js"></script>
<script src="vendors/deck.js/extensions/codemirror/mode/xml/xml.js"></script>
<script src="vendors/deck.js/extensions/codemirror/mode/css/css.js"></script>
<script src="vendors/deck.js/extensions/codemirror/mode/htmlmixed/htmlmixed.js"></script>
<script src="vendors/deck.js/extensions/codemirror/deck.codemirror.js"></script>
        


<!-- Specific to this page -->
<script src="introduction.js"></script>

</body>
</html>
